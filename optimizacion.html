<!DOCTYPE html>
<html>
	<!-- http://hilite.me/ -->
	<head>
		<title>Data Viz. Big Data UAB</title>
		<link href="./styles/style.css" rel="stylesheet" type="text/css">
	</head>
	<body>

		<div class="container">
			<header>
					<p><a href="./index.html">Regresar al Inicio</a>
			</header>


			<h1>Como importar y trabajar con datasets muy grandes</h1>
            <p>
                Uno de los principales problemas que podemos tener al trabajar con datos, es que el conjunto de información (dataset) es demasiado pesado. Cuando cargamos un dataset con la librería Pandas, 
                los datos se almacenan en memoria RAM. Este almacenamiento permite tratar los datos. Pero ¿Qué ocurre si el tamaño del dataset supera la capacidad en RAM de nuestro equipo?
            </p>
            <p>
                Además de este problema, es necesario sumar un segundo factor: el tiempo. Cargar en memoria y procesar un dataset muy grande puede suponer largos tiempos de espera. Por lo tanto, es necesario
                encontrar soluciones que nos permitan procesar estos datos, pero limitando la cantidad de recursos que vamos a usar.
            </p>
            <p>
                Para ello, lo más común es usar los parámetros de pandas <i>nrows</i>, <i>chunksize</i> o <i>sample</i>. Puedes encontrar información sobre cada uno de estos parámetros
                en la documentación oficial de Pandas. Concretamente, en la sección dedicada a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" target="_blank">DataFrame.read_csv(<i>params</i>)</a>.
            </p>
            <h3>Ejemplo de implementación (realizado de clase)</h3>
            <p>Se plantea un ejercicio a los alumnos: Se entrega un dataset de +4GB en formato .csv, que usa como separador el "tabulador", que contiene todos los datos de 
                los directos realizados en Twitch en Español, durante el mes de febrero del 2023. Dicho dataset se ha creado capturando, cada 15 minutos, las métricas principales de las emisiones en directo.
                Se pide a los alumnos que realicen algunos análisis básicos sobre el dataset: buscar el momento de más audiencia, qué streamer lo logró, etc. 
            </p>
            <p>
                Pero la importancia del ejercicio radica en observar los tiempos de cálculo necesarios para llevar a cabo las tareas, y también la cantidad de recursos de memória
                que se deben ocupar. El siguiente código muestra la implementación de los parámetros <i>chunksize</i> y <i>usecols</i>, que tienen como objetivo reducir la cantidad de datos que se cargan en memoria.
            </p>
            <p>
                Antes, se realizó un muestreo del contenido del dataset usando el parámetro <i>nrows</i>, que permite especificar cuantas filas se van a cargar. Esto permite obtener una muestra y saber qué columnas existen, así como el tipo de datos que hay en las filas.
                Tras este análisis preliminar, se procede a trabajar sobre todo el dataset, cargando el mismo usando <i>chunksize</i>. Este parametro parte el dataset en fragmentos, y los carga como si fuera una lista, sobre la que podemos iterar.
            </p>
            <p>El ejemplo plantea la extracción de un "dataset más pequeño" que contenga todos los datos de la KingsLeague durante el mes de febrero.</p>
            
           <!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">pandas</span> <span style="color: #66d9ef">as</span> <span style="color: #f8f8f2">pd</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">time</span>
<span style="color: #75715e"># Columnes en el dataset</span>

<span style="color: #f8f8f2">inici</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">time</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">time()</span>

<span style="color: #f8f8f2">df</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">read_csv(</span><span style="color: #e6db74">&quot;feb-full-2023.csv&quot;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #f8f8f2">sep</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;</span><span style="color: #ae81ff">\t</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #f8f8f2">usecols</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;position&quot;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #e6db74">&quot;captured_at&quot;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #e6db74">&quot;streamer_name&quot;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #e6db74">&quot;viewer_count&quot;</span><span style="color: #f8f8f2">,</span> 
                 <span style="color: #e6db74">&quot;game_name&quot;</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #e6db74">&quot;stream_title&quot;</span><span style="color: #f8f8f2">],</span>
                 <span style="color: #f8f8f2">chunksize</span><span style="color: #f92672">=</span><span style="color: #ae81ff">1000000</span><span style="color: #f8f8f2">,</span>
                 <span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">llista_kings_leage</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">chunk</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">df:</span>
    <span style="color: #f8f8f2">dades_kings_leage</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">chunk[chunk[</span><span style="color: #e6db74">&quot;streamer_name&quot;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;kingsleague&quot;</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">print(dades_kings_leage)</span>
    <span style="color: #f8f8f2">llista_kings_leage</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(dades_kings_leage)</span>

<span style="color: #f8f8f2">final_frame</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pd</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">concat(llista_kings_leage)</span>
<span style="color: #f8f8f2">final_frame</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">to_csv(</span><span style="color: #e6db74">&quot;kingsleague_v2.csv&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">index</span><span style="color: #f92672">=</span><span style="color: #66d9ef">False</span><span style="color: #f8f8f2">)</span>
</pre></div>


			<footer>
			<hr>	
			<p>Adrià Padila</p>
			</footer>
		</div>
	</body>



</html>